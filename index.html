<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Duty Roster - Points Based</title>
    <style>
        :root { --primary: #2563eb; --bg: #f8fafc; --text: #1e293b; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg); color: var(--text); padding: 15px; }
        .container { max-width: 850px; margin: auto; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: var(--primary); margin-bottom: 5px; }
        #date-display { text-align: center; margin-bottom: 20px; font-weight: bold; color: #64748b; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { background: var(--primary); color: white; padding: 12px; text-align: left; }
        td { border-bottom: 1px solid #e2e8f0; padding: 10px; }
        
        /* Dropdown Style */
        .officer-select {
            width: 100%;
            padding: 10px;
            border: 1px solid #cbd5e1;
            border-radius: 6px;
            font-size: 15px;
            background-color: #fff;
            cursor: pointer;
        }
        
        .officer-select:focus { border-color: var(--primary); outline: none; background: #f0f7ff; }

        .btn-group { margin-top: 25px; display: flex; gap: 10px; justify-content: center; }
        .btn { padding: 12px 25px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; color: white; }
        .print-btn { background: #059669; }
        .clear-btn { background: #dc2626; }

        @media print {
            .btn-group, .instruction { display: none; }
            body { padding: 0; }
            .container { box-shadow: none; width: 100%; max-width: 100%; }
        }
    </style>
</head>
<body>

<div class="container">
    <h2>üõ°Ô∏è Smart Duty Management</h2>
    <div id="date-display"></div>

    <p class="instruction" style="font-size: 13px; color: #ef4444;">* ‡∂ë‡∂ö‡∑ä ‡∂ë‡∂ö‡∑ä ‡∑É‡∑ä‡∂Æ‡∑è‡∂±‡∂∫ ‡∑É‡∂≥‡∑Ñ‡∑è ‡∑É‡∑î‡∂Ø‡∑î‡∑É‡∑î ‡∑É‡∑ö‡∑Ä‡∂ö‡∂∫‡∂±‡∑ä ‡∂¥‡∂∏‡∂´‡∂ö‡∑ä ‡∂Ω‡∑ê‡∂∫‡∑í‡∑É‡∑ä‡∂≠‡∑î‡∑Ä‡∑ö ‡∂¥‡∑ô‡∂±‡∑ä‡∑Ä‡∂±‡∑î ‡∂á‡∂≠.</p>

    <table id="dutyTable">
        <thead>
            <tr>
                <th style="width: 8%;">#</th>
                <th style="width: 42%;">‡∑É‡∑ä‡∂Æ‡∑è‡∂±‡∂∫ (Duty Point)</th>
                <th>‡∂±‡∑í‡∂Ω‡∂∞‡∑è‡∂ª‡∑í‡∂∫‡∑è ‡∂≠‡∑ù‡∂ª‡∂±‡∑ä‡∂± (Select Officer)</th>
            </tr>
        </thead>
        <tbody id="tableBody"></tbody>
    </table>

    <div class="btn-group">
        <button class="btn print-btn" onclick="window.print()">Print Report</button>
        <button class="btn clear-btn" onclick="clearRoster()">Clear All</button>
    </div>
</div>

<script>
    // 1. ‡∑É‡∑ö‡∑Ä‡∂ö ‡∂Ω‡∑ê‡∂∫‡∑í‡∑É‡∑ä‡∂≠‡∑î‡∑Ä ‡∑É‡∑Ñ ‡∂î‡∑Ä‡∑î‡∂±‡∑ä‡∂ß ‡∂ö‡∑Ö ‡∑Ñ‡∑ê‡∂ö‡∑í ‡∑É‡∑ä‡∂Æ‡∑è‡∂± (Points) ‡∂∏‡∑ô‡∑Ñ‡∑í ‡∂á‡∂≠‡∑î‡∑Ö‡∂≠‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±
    const staffData = [
        { name: "P. Perera", allowedPoints: ["Guard Room", "Main Gate", "Rounds"] },
        { name: "S. Kumara", allowedPoints: ["M/E", "Time Office", "Pharmacy"] },
        { name: "A. Silva", allowedPoints: ["CCTV New", "CCTV Old", "Lobby"] },
        { name: "W. Jayasinghe", allowedPoints: ["SICU", "Micu", "Doc Lift"] },
        { name: "N. Fernando", allowedPoints: ["Kitchen", "K/ Stores", "B/C/P"] },
        { name: "M. Gamage", allowedPoints: ["Guard Room", "Fort City", "L. Hostal New"] },
        // ‡∂≠‡∑Ä ‡∑É‡∑ö‡∑Ä‡∂ö‡∂∫‡∂±‡∑ä ‡∂∏‡∑ô‡∂≠‡∂±‡∂ß ‡∂ë‡∂ö‡∂≠‡∑î ‡∂ö‡∂ª‡∂±‡∑ä‡∂±...
    ];

    const points = [
        "Guard Room", "Guard Room", "M/E", "M/E", "Time Office", "B/C/P", "B/C/P", 
        "Glass Door", "Lobby", "Lobby", "C/P/R", "Doc Lift", "Pharmacy", "Pharmacy OPD", 
        "Pahamacy H.", "CCTV New", "CCTV New", "C/P/03", "C/P/04", "Com. Hostal", 
        "Rounds", "Rounds", "K/ Stores", "Kitchen", "Main Gate", "2nd B", "SICU", 
        "Micu", "CCTV Old", "CCTV Old", "L/L 03", "L/L 04", "L/L 05", "L/L 06", 
        "Fort City", "L. Hostal New", "Hostal Old", "Hostal New", "Layanal", "Bambala..", "Dilan"
    ];

    function renderTable() {
        const tableBody = document.getElementById('tableBody');
        tableBody.innerHTML = "";

        points.forEach((point, index) => {
            // ‡∂ë‡∂∏ ‡∑É‡∑ä‡∂Æ‡∑è‡∂±‡∂∫‡∂ß ‡∂Ö‡∂Ø‡∑è‡∑Ö ‡∑É‡∑ö‡∑Ä‡∂ö‡∂∫‡∂±‡∑ä ‡∂¥‡∂∏‡∂´‡∂ö‡∑ä ‡∂¥‡∑ô‡∂ª‡∑è ‡∂ú‡∑ê‡∂±‡∑ì‡∂∏ (Filter)
            const eligibleStaff = staffData.filter(s => s.allowedPoints.includes(point));
            
            // ‡∂ö‡∂Ω‡∑í‡∂±‡∑ä ‡∑É‡∑ö‡∑Ä‡∑ä ‡∂ö‡∑Ö ‡∂±‡∂∏ ‡∂á‡∂≠‡∑ä‡∂±‡∂∏‡∑ä ‡∂ë‡∂∫ ‡∂Ω‡∂∂‡∑è ‡∂ú‡∑ê‡∂±‡∑ì‡∂∏
            const savedValue = localStorage.getItem(`smart_duty_${index}`) || "";

            let selectHTML = `<select class="officer-select" onchange="saveSelection(${index}, this.value)">
                                <option value="">‡∂±‡∂∏ ‡∂≠‡∑ù‡∂ª‡∂±‡∑ä‡∂±...</option>`;
            
            eligibleStaff.forEach(staff => {
                let selected = (savedValue === staff.name) ? "selected" : "";
                selectHTML += `<option value="${staff.name}" ${selected}>${staff.name}</option>`;
            });

            // ‡∂ö‡∑í‡∑É‡∑í‡∂∏ ‡∑Ä‡∑í‡∑Å‡∑ö‡∑Ç‡∑í‡∂≠ ‡∑É‡∑ö‡∑Ä‡∂ö‡∂∫‡∑ô‡∂ö‡∑ä ‡∂±‡∑ê‡∂≠‡∑í‡∂±‡∂∏‡∑ä ‡∑É‡∑í‡∂∫‡∂Ω‡∑î ‡∑É‡∑ö‡∑Ä‡∂ö‡∂∫‡∂±‡∑ä ‡∑Ñ‡∑ù "No Staff Assigned" ‡∂¥‡∑ô‡∂±‡∑ä‡∑Ä‡∑í‡∂∫ ‡∑Ñ‡∑ê‡∂ö
            if(eligibleStaff.length === 0) {
                selectHTML += `<option value="" disabled>‡∑É‡∑î‡∂Ø‡∑î‡∑É‡∑î ‡∑É‡∑ö‡∑Ä‡∂ö‡∂∫‡∑í‡∂±‡∑ä ‡∂±‡∑ê‡∂≠</option>`;
            }

            selectHTML += `</select>`;

            let row = `<tr>
                <td>${index + 1}</td>
                <td><strong>${point}</strong></td>
                <td>${selectHTML}</td>
            </tr>`;
            tableBody.innerHTML += row;
        });
    }

    function saveSelection(index, value) {
        localStorage.setItem(`smart_duty_${index}`, value);
    }

    function clearRoster() {
        if(confirm("‡∑É‡∑í‡∂∫‡∂Ω‡∑î‡∂∏ ‡∂Ø‡∂≠‡∑ä‡∂≠ ‡∂∏‡∑ê‡∂ö‡∑ì‡∂∏‡∂ß ‡∂Ö‡∑Ä‡∑Å‡∑ä‚Äç‡∂∫‡∂Ø?")) {
            localStorage.clear();
            renderTable();
        }
    }

    // ‡∂Ø‡∑í‡∂±‡∂∫ ‡∑É‡∑ê‡∂ö‡∑É‡∑ì‡∂∏
    const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
    document.getElementById('date-display').innerText = new Date().toLocaleDateString('si-LK', options);

    renderTable();
</script>

</body>
</html>

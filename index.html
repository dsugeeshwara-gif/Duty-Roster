<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Duty Management System</title>
    <style>
        :root { --primary: #2563eb; --success: #10b981; --danger: #ef4444; --dark: #1e293b; --bg: #f8fafc; }
        body { font-family: 'Inter', system-ui, sans-serif; background: var(--bg); margin: 0; padding: 10px; }
        .container { max-width: 900px; margin: auto; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        
        .tabs { display: flex; gap: 8px; margin-bottom: 15px; background: #eee; padding: 5px; border-radius: 8px; }
        .tab { flex: 1; text-align: center; padding: 10px; cursor: pointer; border-radius: 6px; font-weight: bold; font-size: 14px; transition: 0.3s; }
        .tab.active { background: var(--primary); color: white; }

        .hidden { display: none; }
        
        /* Admin UI */
        .admin-controls { background: #eff6ff; padding: 15px; border-radius: 10px; margin-bottom: 20px; border: 1px dashed var(--primary); }
        .staff-card { background: #fff; border: 1px solid #e2e8f0; padding: 12px; border-radius: 8px; margin-bottom: 10px; }
        .point-switches { display: grid; grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); gap: 5px; margin-top: 10px; }
        .sw-btn { padding: 5px; font-size: 10px; border: 1px solid #cbd5e1; border-radius: 4px; cursor: pointer; background: white; white-space: nowrap; overflow: hidden; }
        .sw-btn.active { background: var(--success); color: white; border-color: var(--success); }

        /* Table UI */
        table { width: 100%; border-collapse: collapse; font-size: 14px; }
        th { background: var(--dark); color: white; padding: 12px; text-align: left; }
        td { border-bottom: 1px solid #e2e8f0; padding: 10px; }
        select { width: 100%; padding: 8px; border-radius: 5px; border: 1px solid #ccc; font-size: 14px; }

        .shift-btn-group { display: flex; gap: 10px; margin-bottom: 15px; justify-content: center; }
        .shift-btn { padding: 8px 20px; border: 2px solid var(--primary); border-radius: 20px; cursor: pointer; font-weight: bold; background: white; color: var(--primary); }
        .shift-btn.active { background: var(--primary); color: white; }

        .action-btn { background: var(--primary); color: white; border: none; padding: 10px 15px; border-radius: 6px; cursor: pointer; font-weight: bold; width: 100%; margin-top: 10px; }

        @media print { .tabs, .admin-controls, .shift-btn-group, .action-btn { display: none; } .container { box-shadow: none; border: none; width: 100%; } }
    </style>
</head>
<body>

<div class="container">
    <div class="tabs">
        <div class="tab active" onclick="showTab('roster-tab')">රාජකාරි වගුව (Roster)</div>
        <div class="tab" onclick="showTab('admin-tab')">පාලක පුවරුව (Admin)</div>
    </div>

    <div id="roster-tab">
        <div class="shift-btn-group">
            <div class="shift-btn active" id="btnDay" onclick="setShift('Day')">දිවා (Day)</div>
            <div class="shift-btn" id="btnNight" onclick="setShift('Night')">රාත්‍රී (Night)</div>
        </div>
        
        <table id="rosterTable">
            <thead>
                <tr>
                    <th style="width: 50px;">#</th>
                    <th>ස්ථානය (Point)</th>
                    <th>නිලධාරියා</th>
                </tr>
            </thead>
            <tbody id="rosterBody"></tbody>
        </table>
        <button class="action-btn" style="background: #059669;" onclick="window.print()">Print Today's Roster</button>
    </div>

    <div id="admin-tab" class="hidden">
        <div class="admin-controls">
            <h4 style="margin: 0 0 10px 0;">ඉක්මන් ඇතුළත් කිරීම</h4>
            <p style="font-size: 12px; color: #666;">පහත බොත්තම එබූ විට කලින් තිබූ නාමලේඛනය ස්වයංක්‍රීයව පද්ධතියට එකතු වේ.</p>
            <button class="action-btn" onclick="loadDefaultStaff()">Load Default Staff List</button>
        </div>

        <div id="staffList"></div>
    </div>
</div>

<script>
    const allPoints = ["Guard Room", "M/E", "Time Office", "B/C/P", "Glass Door", "Lobby", "C/P/R", "Doc Lift", "Pharmacy", "Pharmacy OPD", "CCTV New", "Rounds", "K/ Stores", "Kitchen", "Main Gate", "2nd B", "SICU", "Micu", "CCTV Old", "Fort City", "Hostal New", "Layanal", "Dilan"];

    const defaultStaff = [
        "OIC අසංක", "OIC කුමාර", "OIC සුරංජිත්", "OIC සමරනායක", "OIC දයාරත්න", "OIC සුරේෂ්", "OIC මෙන්ඩිස්", "OIC විජිතලාල්", "OIC රංගන",
        "SSO තාරක", "SSO ජයලත්", "SSO විරේශ්", "SSO රවී", "SSO අජිත්", "SSO මනූෂ", "SSO රත්නදාස",
        "LOIC රීටා", "LOIC මල්කාන්ති",
        "JSO ප්‍රසන්න", "JSO ප්‍රදීප් (නාමල්)", "JSO චන්දන", "JSO විජේරත්න", "JSO රාජ්", "JSO දිනේෂ්", "JSO රවිඳු", "JSO ලොකුබංඩා", "JSO සුනිල්", "JSO සම්පත්",
        "LSO සීලවතී", "LSO නාලනී", "LSO විමලසූරිය", "LSO නන්දනී", "LSO නන්දලතා", "LSO ඩිලානි", "LSO ශ්‍රියාලතා", "LSO ශාන්ති", "LSO නුගවෙල", "LSO චම්පිකා", "LSO පෙරේරා"
    ];

    let staffData = JSON.parse(localStorage.getItem('duty_staff_db')) || [];
    let currentShift = 'Day';

    function showTab(tabId) {
        document.getElementById('roster-tab').classList.add('hidden');
        document.getElementById('admin-tab').classList.add('hidden');
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.getElementById(tabId).classList.remove('hidden');
        event.currentTarget.classList.add('active');
        if(tabId === 'roster-tab') renderRoster(); else renderAdmin();
    }

    function setShift(s) {
        currentShift = s;
        document.getElementById('btnDay').classList.toggle('active', s === 'Day');
        document.getElementById('btnNight').classList.toggle('active', s === 'Night');
        renderRoster();
    }

    function loadDefaultStaff() {
        if(confirm("දැනට ඇති සේවක ලැයිස්තුව මකා දමා ප්‍රධාන නාමලේඛනය ඇතුළත් කරන්නද?")) {
            staffData = defaultStaff.map(name => ({ name: name, allowedPoints: [] }));
            save();
            renderAdmin();
        }
    }

    function togglePoint(sIdx, point) {
        let allowed = staffData[sIdx].allowedPoints;
        if(allowed.includes(point)) staffData[sIdx].allowedPoints = allowed.filter(p => p !== point);
        else staffData[sIdx].allowedPoints.push(point);
        save();
        renderAdmin();
    }

    function renderAdmin() {
        const list = document.getElementById('staffList');
        list.innerHTML = "";
        staffData.forEach((s, i) => {
            let pButtons = allPoints.map(p => `
                <button class="sw-btn ${s.allowedPoints.includes(p) ? 'active' : ''}" onclick="togglePoint(${i}, '${p}')">${p}</button>
            `).join('');
            list.innerHTML += `<div class="staff-card"><b>${s.name}</b><div class="point-switches">${pButtons}</div></div>`;
        });
    }

    function renderRoster() {
        const body = document.getElementById('rosterBody');
        body.innerHTML = "";
        allPoints.forEach((p, idx) => {
            const eligible = staffData.filter(s => s.allowedPoints.includes(p));
            let saved = localStorage.getItem(`sel_${currentShift}_${idx}`) || "";
            let opts = eligible.map(s => `<option value="${s.name}" ${saved === s.name ? 'selected' : ''}>${s.name}</option>`).join('');
            body.innerHTML += `<tr><td>${idx+1}</td><td><b>${p}</b></td><td><select onchange="localStorage.setItem('sel_${currentShift}_${idx}', this.value)"><option value="">-- තෝරන්න --</option>${opts}</select></td></tr>`;
        });
    }

    function save() { localStorage.setItem('duty_staff_db', JSON.stringify(staffData)); }

    renderRoster();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Security Duty Roster System</title>
<style>
body { font-family: Arial; background:#f4f6f8; padding:20px }
h2 { margin-top:30px }
.box { background:#fff; padding:15px; margin-bottom:20px; border-radius:8px }
.member { display:inline-block; width:220px }
.point { margin-bottom:10px }
select { padding:5px; width:200px }
button { padding:10px 15px; margin-top:10px }
</style>
</head>

<body>

<h1>Security Duty Assignment</h1>

<!-- MEMBERS -->
<div class="box">
<h2>All Staff</h2>
<div id="members"></div>
</div>

<!-- DAY ATTENDANCE -->
<div class="box">
<h2>Day Shift Attendance</h2>
<div id="dayAttendance"></div>
<button onclick="renderPoints('day')">Load Day Points</button>
</div>

<!-- NIGHT ATTENDANCE -->
<div class="box">
<h2>Night Shift Attendance</h2>
<div id="nightAttendance"></div>
<button onclick="renderPoints('night')">Load Night Points</button>
</div>

<!-- POINTS -->
<div class="box">
<h2>Duty Points</h2>
<div id="points"></div>
<button onclick="autoAssign()">Auto Assign</button>
</div>

<script>
// ================= STAFF DATABASE =================
const members = [
  {name:"Dayarathna", skills:["Guard Room","Goods Receiving"], blocked:["CCTV New","CCTV Old"]},
  {name:"Asanka", skills:["Main Gate","Goods Receiving"], blocked:["2B"]},
  {name:"Kumara", skills:["Guard Room","Time Office"]},
  {name:"Samaranayaka", skills:["CCTV Old","CCTV New"]},
  {name:"Wijethunga", skills:["CCTV Old","CCTV New","Guard Room"]},
  {name:"Rangana", skills:["CCTV Old","CCTV New","Goods Receiving"]},
  {name:"Sampath", skills:["CCTV Old","CCTV New"]},
  {name:"Suresh", skills:["Guard Room","Goods Receiving"], blocked:["2B"]},
  {name:"Mendis", skills:["CCTV Old","CCTV New","Guard Room"]}
];

// ================= POINTS =================
const points = [
  "Guard Room",
  "Goods Receiving",
  "CCTV New",
  "CCTV Old",
  "Main Gate",
  "Time Office",
  "2B"
];

// ================= LOAD STAFF =================
function loadStaff() {
  let html="";
  members.forEach(m=>{
    html+=`<div class="member">üëÆ ${m.name}</div>`;
  });
  document.getElementById("members").innerHTML=html;

  let day="", night="";
  members.forEach(m=>{
    day+=`<label class="member">
      <input type="checkbox" class="dayCheck" value="${m.name}"> ${m.name}
    </label>`;
    night+=`<label class="member">
      <input type="checkbox" class="nightCheck" value="${m.name}"> ${m.name}
    </label>`;
  });

  document.getElementById("dayAttendance").innerHTML=day;
  document.getElementById("nightAttendance").innerHTML=night;
}
loadStaff();

// ================= FILTER ENGINE =================
function allowedPeople(point, presentNames) {
  return members.filter(m=>{
    if(!presentNames.includes(m.name)) return false;
    if(m.blocked && m.blocked.includes(point)) return false;
    return m.skills.includes(point);
  });
}

// ================= RENDER POINTS =================
function renderPoints(shift) {
  const checks = document.querySelectorAll(
    shift==="day" ? ".dayCheck:checked" : ".nightCheck:checked"
  );
  const presentNames = [...checks].map(c=>c.value);

  let html="";
  points.forEach(p=>{
    const allowed = allowedPeople(p,presentNames);
    html+=`
      <div class="point">
        <b>${p}</b><br>
        <select>
          <option value="">-- Select --</option>
          ${
            allowed.length
            ? allowed.map(a=>`<option>${a.name}</option>`).join("")
            : `<option disabled>‚ùå No suitable person</option>`
          }
        </select>
      </div>`;
  });

  document.getElementById("points").innerHTML=html;
}

// ================= AUTO ASSIGN =================
function autoAssign() {
  let used=[];
  document.querySelectorAll("#points select").forEach(sel=>{
    for(let opt of sel.options){
      if(opt.value && !used.includes(opt.value)){
        sel.value=opt.value;
        used.push(opt.value);
        break;
      }
    }
  });
}
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Duty Management Pro v7.0</title>
    <style>
        :root { --primary: #2563eb; --success: #10b981; --dark: #1e293b; --bg: #f8fafc; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); margin: 0; padding: 10px; }
        .container { max-width: 1200px; margin: auto; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        
        .tabs { display: flex; gap: 8px; margin-bottom: 15px; background: #eee; padding: 5px; border-radius: 8px; }
        .tab { flex: 1; text-align: center; padding: 10px; cursor: pointer; border-radius: 6px; font-weight: bold; font-size: 14px; }
        .tab.active { background: var(--primary); color: white; }
        .hidden { display: none; }
        
        /* Shift Toggle */
        .shift-selector { display: flex; gap: 10px; margin-bottom: 20px; }
        .shift-btn { flex: 1; padding: 12px; border: 2px solid #e2e8f0; border-radius: 10px; cursor: pointer; font-weight: bold; background: white; transition: 0.3s; }
        .shift-btn.active.day { border-color: #f59e0b; background: #fffbeb; color: #b45309; }
        .shift-btn.active.night { border-color: #4338ca; background: #eef2ff; color: #3730a3; }

        /* Point Config */
        .config-card { background: #fff; border: 1px solid #cbd5e1; padding: 12px; border-radius: 8px; margin-bottom: 10px; display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 10px; align-items: center; }
        .config-header { font-weight: bold; font-size: 12px; color: #64748b; margin-bottom: 5px; }

        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { background: var(--dark); color: white; padding: 12px; text-align: left; }
        td { border-bottom: 1px solid #e2e8f0; padding: 10px; }

        .slot-box { margin-bottom: 5px; }
        .action-btn { background: var(--primary); color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; margin-top: 15px; }
        select { width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #ccc; font-size: 14px; }
        
        @media print { .tabs, .shift-selector, .admin-section, .action-btn { display: none; } }
    </style>
</head>
<body>

<div class="container">
    <div class="tabs">
        <div class="tab active" onclick="showTab('roster-tab')">‡∂ª‡∑è‡∂¢‡∂ö‡∑è‡∂ª‡∑í ‡∑Ä‡∂ú‡∑î‡∑Ä (Roster)</div>
        <div class="tab" onclick="showTab('admin-tab')">‡∂¥‡∑ú‡∂∫‡∑í‡∂±‡∑ä‡∂ß‡∑ä ‡∑É‡∑ê‡∂ö‡∑É‡∑î‡∂∏‡∑ä (Setup)</div>
    </div>

    <div id="roster-tab">
        <div class="shift-selector">
            <button class="shift-btn day active" id="btnDay" onclick="setShift('Day')">‚òÄÔ∏è ‡∂Ø‡∑í‡∑Ä‡∑è (Day)</button>
            <button class="shift-btn night" id="btnNight" onclick="setShift('Night')">üåô ‡∂ª‡∑è‡∂≠‡∑ä‚Äç‡∂ª‡∑ì (Night)</button>
        </div>

        <table id="rosterTable">
            <thead>
                <tr>
                    <th style="width: 50px;">#</th>
                    <th>‡∑É‡∑ä‡∂Æ‡∑è‡∂±‡∂∫ (Point)</th>
                    <th>‡∂±‡∑í‡∂Ω‡∂∞‡∑è‡∂ª‡∑í‡∂∫‡∑è/‡∂±‡∑í‡∂Ω‡∂∞‡∑è‡∂ª‡∑ì‡∂±‡∑ä (Officers)</th>
                </tr>
            </thead>
            <tbody id="rosterBody"></tbody>
        </table>
        <button class="action-btn" style="background:#059669;" onclick="window.print()">‡∂∏‡∑î‡∂Ø‡∑ä‚Äç‡∂ª‡∂´‡∂∫ ‡∂ö‡∂ª‡∂±‡∑ä‡∂± (Print)</button>
    </div>

    <div id="admin-tab" class="hidden">
        <div class="admin-section">
            <h3>‡∑É‡∑ö‡∑Ä‡∑è ‡∂∏‡∑î‡∂ª‡∂∫ ‡∂Ö‡∂±‡∑î‡∑Ä ‡∂±‡∑í‡∂Ω‡∂∞‡∑è‡∂ª‡∑ì‡∂±‡∑ä ‡∂ú‡∂´‡∂± ‡∂≠‡∑ì‡∂ª‡∂´‡∂∫ ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏</h3>
            <div class="config-card" style="background: none; border:none; padding-bottom:0;">
                <div class="config-header">‡∂¥‡∑ú‡∂∫‡∑í‡∂±‡∑ä‡∂ß‡∑ä ‡∂ë‡∂ö</div>
                <div class="config-header">‡∂Ø‡∑í‡∑Ä‡∑è ‡∂ú‡∂´‡∂±</div>
                <div class="config-header">‡∂ª‡∑è‡∂≠‡∑ä‚Äç‡∂ª‡∑ì ‡∂ú‡∂´‡∂±</div>
            </div>
            <div id="pointConfigList"></div>
            <button class="action-btn" onclick="loadDefaultStaff()">Load Master Staff List</button>
        </div>
    </div>
</div>

<script>
    const pointsArray = ["Guard Room", "M/E Entry", "Time Office", "B/C/P", "Glass Door", "Lobby", "C/P/R", "Doctors' Lift", "Pharmacy - Main", "Pharmacy - OPD", "Pharmacy - Helper", "CCTV New", "C/P/03", "C/P/04", "Commercial Hostel", "Rounds", "Kitchen Stores", "Kitchen", "Main Gate", "2nd Basement", "SICU", "MICU", "CCTV Old", "Lift Lobby - 3rd Floor", "Lift Lobby - 4th Floor", "Lift Lobby - 5th Floor", "Lift Lobby - 6th Floor", "Fort City", "Lady Hostel - New", "Hostal - Old", "Hostal - New", "Layanal Area", "Bambalapitiya Area", "Dilan Area", "Receiving"];

    // Default settings: Most points have 1 officer in day/night
    let pointData = JSON.parse(localStorage.getItem('point_config_v7')) || 
        pointsArray.reduce((acc, p) => ({ ...acc, [p]: { day: 1, night: 1 } }), {});

    let staffData = JSON.parse(localStorage.getItem('duty_staff_v7')) || [];
    let currentShift = 'Day';

    function showTab(tabId) {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.getElementById('roster-tab').classList.add('hidden');
        document.getElementById('admin-tab').classList.add('hidden');
        document.getElementById(tabId).classList.remove('hidden');
        event.currentTarget.classList.add('active');
        if(tabId === 'admin-tab') renderAdmin(); else renderRoster();
    }

    function renderAdmin() {
        const list = document.getElementById('pointConfigList');
        list.innerHTML = pointsArray.map(p => `
            <div class="config-card">
                <div style="font-weight:bold; font-size:14px;">${p}</div>
                <input type="number" min="0" value="${pointData[p].day}" onchange="updateConfig('${p}', 'day', this.value)">
                <input type="number" min="0" value="${pointData[p].night}" onchange="updateConfig('${p}', 'night', this.value)">
            </div>
        `).join('');
    }

    function updateConfig(point, shift, val) {
        pointData[point][shift] = parseInt(val) || 0;
        localStorage.setItem('point_config_v7', JSON.stringify(pointData));
    }

    function setShift(s) {
        currentShift = s;
        document.getElementById('btnDay').classList.toggle('active', s === 'Day');
        document.getElementById('btnNight').classList.toggle('active', s === 'Night');
        renderRoster();
    }

    function renderRoster() {
        const body = document.getElementById('rosterBody');
        body.innerHTML = "";
        let rowIdx = 1;

        pointsArray.forEach(p => {
            const count = (currentShift === 'Day') ? pointData[p].day : pointData[p].night;
            
            // ‡∂±‡∑í‡∂Ω‡∂∞‡∑è‡∂ª‡∑ì‡∂±‡∑ä ‡∂ú‡∂´‡∂± 0 ‡∂ß ‡∑Ä‡∂©‡∑è ‡∑Ä‡∑ê‡∂©‡∑í ‡∂±‡∂∏‡∑ä ‡∂¥‡∂∏‡∂´‡∂ö‡∑ä ‡∂¥‡∑ô‡∂±‡∑ä‡∑Ä‡∂±‡∑ä‡∂±
            if (count > 0) {
                let slotsHTML = "";
                for (let i = 1; i <= count; i++) {
                    let saved = localStorage.getItem(`s_${currentShift}_${p}_${i}`) || "";
                    slotsHTML += `
                        <div class="slot-box">
                            <select onchange="localStorage.setItem('s_${currentShift}_${p}_${i}', this.value)">
                                <option value="">-- ‡∂±‡∑í‡∂Ω‡∂∞‡∑è‡∂ª‡∑í‡∂∫‡∑è ${count > 1 ? i : ''} ‡∂≠‡∑ù‡∂ª‡∂±‡∑ä‡∂± --</option>
                                ${staffData.map(s => `<option value="${s.name}" ${saved === s.name ? 'selected' : ''}>${s.name}</option>`).join('')}
                            </select>
                        </div>`;
                }

                body.innerHTML += `
                    <tr>
                        <td>${rowIdx++}</td>
                        <td><b>${p}</b> <br><small style="color:blue;">(Officers: ${count})</small></td>
                        <td>${slotsHTML}</td>
                    </tr>`;
            }
        });
    }

    function loadDefaultStaff() {
        // ‡∂î‡∂∂ ‡∂∏‡∑ì‡∂ß ‡∂¥‡∑ô‡∂ª ‡∂Ω‡∂∂‡∑è ‡∂Ø‡∑î‡∂±‡∑ä ‡∑É‡∂∏‡∑ä‡∂¥‡∑ñ‡∂ª‡∑ä‡∂´ ‡∂±‡∑è‡∂∏‡∂Ω‡∑ö‡∂õ‡∂±‡∂∫ ‡∂∏‡∑ô‡∑Ñ‡∑í ‡∂¥‡∑Ä‡∂≠‡∑í‡∂± ‡∂∂‡∑Ä ‡∂ã‡∂¥‡∂ö‡∂Ω‡∑ä‡∂¥‡∂±‡∂∫ ‡∂ö‡∑ô‡∂ª‡∑ö
        const names = ["OIC ‡∂Ö‡∑É‡∂Ç‡∂ö", "OIC ‡∂ö‡∑î‡∂∏‡∑è‡∂ª", "SSO ‡∂≠‡∑è‡∂ª‡∂ö", "LSO ‡∑É‡∑ì‡∂Ω‡∑Ä‡∂≠‡∑ì", "JSO ‡∂Ø‡∑í‡∂±‡∑ö‡∑Ç‡∑ä"]; 
        staffData = names.map(n => ({ name: n }));
        localStorage.setItem('duty_staff_v7', JSON.stringify(staffData));
        renderRoster();
    }

    renderRoster();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IronShield Defender Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --primary: #1a237e; --secondary: #d32f2f; --success: #2e7d32; }
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; margin: 0; }
        .header { background: var(--primary); color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 1000; }
        
        /* Settings Dropdown */
        .settings-dropdown { position: relative; display: inline-block; }
        .dropdown-content { display: none; position: absolute; right: 0; background-color: white; min-width: 200px; box-shadow: 0 8px 16px rgba(0,0,0,0.2); border-radius: 8px; z-index: 1; }
        .dropdown-content a { color: black; padding: 12px 16px; text-decoration: none; display: block; border-bottom: 1px solid #eee; }
        .dropdown-content a:hover { background-color: #f1f1f1; }
        .show { display: block; }

        .container { max-width: 500px; margin: 20px auto; background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .step-panel { display: none; }
        .step-panel.active { display: block; }
        
        .member-row { display: flex; justify-content: space-between; align-items: center; padding: 12px; border-bottom: 1px solid #eee; }
        .btn { width: 100%; padding: 15px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .btn-next { background: var(--primary); color: white; }
        
        /* Modal for adding members */
        .modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); }
        .modal-content { background: white; margin: 20% auto; padding: 20px; width: 80%; border-radius: 10px; }
        input[type="text"] { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
        
        /* Toggle Switch */
        .switch { position: relative; width: 40px; height: 20px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 20px; }
        input:checked + .slider { background-color: var(--success); }
        .slider:before { position: absolute; content: ""; height: 14px; width: 14px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider:before { transform: translateX(20px); }
    </style>
</head>
<body>

<div class="header">
    <div style="font-weight: bold;">IRONSHIELD DEFENDER</div>
    <div class="settings-dropdown">
        <i class="fas fa-cog fa-lg" onclick="toggleDropdown()" style="cursor: pointer;"></i>
        <div id="myDropdown" class="dropdown-content">
            <a href="#" onclick="showModal('member')"><i class="fas fa-user-plus"></i> ‡∑É‡∑è‡∂∏‡∑è‡∂¢‡∑í‡∂ö‡∂∫‡∂±‡∑ä ‡∂ë‡∂ö‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±</a>
            <a href="#" onclick="showModal('point')"><i class="fas fa-map-marker-alt"></i> ‡∑É‡∑ä‡∂Æ‡∑è‡∂± ‡∂ë‡∂ö‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±</a>
            <a href="#" onclick="clearAllData()" style="color:red;"><i class="fas fa-trash"></i> ‡∂Ø‡∂≠‡∑ä‡∂≠ ‡∂∏‡∂ö‡∑è ‡∂Ø‡∂∏‡∂±‡∑ä‡∂±</a>
        </div>
    </div>
</div>

<div class="container">
    <div id="step1" class="step-panel active">
        <h3 style="text-align:center; color: var(--primary);">2. ‡∂Ö‡∂Ø ‡∂¥‡∑ê‡∂∏‡∑í‡∂´ ‡∑É‡∑í‡∂ß‡∑í‡∂± ‡∂Ö‡∂∫ (Attendance)</h3>
        <div id="attendance-list"></div>
        <button class="btn btn-next" onclick="goToStep2()">‡∂©‡∑í‡∂∫‡∑î‡∂ß‡∑í ‡∂∂‡∑ô‡∂Ø‡∑è‡∂Ø‡∑ì‡∂∏‡∂ß (Next) ‚ûî</button>
    </div>

    <div id="step2" class="step-panel">
        <h3 style="text-align:center; color: var(--primary);">3. ‡∂ª‡∑è‡∂¢‡∂ö‡∑è‡∂ª‡∑í ‡∑É‡∑ä‡∂Æ‡∑è‡∂±</h3>
        <div id="point-list"></div>
        <button class="btn btn-next" style="background:var(--success)" onclick="sendWhatsApp()">WhatsApp ‡∂∫‡∑Ä‡∂±‡∑ä‡∂±</button>
        <button class="btn" onclick="goToStep1()" style="background:#eee">‡∂Ü‡∂¥‡∑É‡∑î</button>
    </div>
</div>

<div id="dataModal" class="modal">
    <div class="modal-content">
        <h3 id="modalTitle">‡∂Ö‡∂Ω‡∑î‡∂≠‡∑ä ‡∂±‡∂∏‡∂ö‡∑ä ‡∂á‡∂≠‡∑î‡∑Ö‡∂≠‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±</h3>
        <input type="text" id="modalInput" placeholder="‡∂±‡∂∏ ‡∂∏‡∑ô‡∂≠‡∑ê‡∂± ‡∂ß‡∂∫‡∑í‡∂¥‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±...">
        <button class="btn btn-next" onclick="saveNewData()">‡∑É‡∑î‡∂ª‡∂ö‡∑í‡∂±‡∑ä‡∂±</button>
        <button class="btn" onclick="closeModal()" style="background:#eee">‡∂Ö‡∑Ä‡∂Ω‡∂Ç‡∂ú‡∑î ‡∂ö‡∂ª‡∂±‡∑ä‡∂±</button>
    </div>
</div>

<script>
    let members = JSON.parse(localStorage.getItem('is_members')) || ["OIC Asanka", "OIC Kumara", "SSO Tharaka"];
    let points = JSON.parse(localStorage.getItem('is_points')) || ["Main Gate", "Pharmacy", "Guard Room"];
    let currentModalType = '';

    function toggleDropdown() { document.getElementById("myDropdown").classList.toggle("show"); }
    window.onclick = function(event) { if (!event.target.matches('.fa-cog')) { 
        document.getElementById("myDropdown").classList.remove("show"); 
    }}

    function showModal(type) {
        currentModalType = type;
        document.getElementById('modalTitle').innerText = type === 'member' ? "‡∂Ö‡∂Ω‡∑î‡∂≠‡∑ä ‡∑É‡∑è‡∂∏‡∑è‡∂¢‡∑í‡∂ö‡∂∫‡∑ô‡∂ö‡∑ä" : "‡∂Ö‡∂Ω‡∑î‡∂≠‡∑ä ‡∂ª‡∑è‡∂¢‡∂ö‡∑è‡∂ª‡∑í ‡∑É‡∑ä‡∂Æ‡∑è‡∂±‡∂∫‡∂ö‡∑ä";
        document.getElementById('dataModal').style.display = "block";
    }
    
    function closeModal() { document.getElementById('dataModal').style.display = "none"; }

    function saveNewData() {
        const val = document.getElementById('modalInput').value;
        if(!val) return;
        if(currentModalType === 'member') {
            members.push(val);
            localStorage.setItem('is_members', JSON.stringify(members));
        } else {
            points.push(val);
            localStorage.setItem('is_points', JSON.stringify(points));
        }
        document.getElementById('modalInput').value = '';
        closeModal();
        renderAttendance();
    }

    function renderAttendance() {
        const list = document.getElementById('attendance-list');
        list.innerHTML = members.map(m => `
            <div class="member-row">
                <span>${m}</span>
                <label class="switch">
                    <input type="checkbox" checked class="att-check" data-name="${m}">
                    <span class="slider"></span>
                </label>
            </div>`).join('');
    }

    function goToStep2() {
        const present = Array.from(document.querySelectorAll('.att-check:checked')).map(c => c.dataset.name);
        document.getElementById('step1').classList.remove('active');
        document.getElementById('step2').classList.add('active');
        
        const pList = document.getElementById('point-list');
        pList.innerHTML = points.map(p => `
            <div style="margin-bottom:15px; border:1px solid #ddd; padding:10px; border-radius:8px;">
                <div style="font-weight:bold; color:red; margin-bottom:5px;">${p}</div>
                <select class="duty-sel" data-point="${p}" style="width:100%; padding:8px;">
                    <option value="">-- ‡∂≠‡∑ù‡∂ª‡∂±‡∑ä‡∂± --</option>
                    ${present.map(m => `<option value="${m}">${m}</option>`).join('')}
                </select>
            </div>`).join('');
    }

    function goToStep1() {
        document.getElementById('step2').classList.remove('active');
        document.getElementById('step1').classList.add('active');
    }

    function sendWhatsApp() {
        let msg = "*IRONSHIELD DEFENDER - DUTY*\n\n";
        document.querySelectorAll('.duty-sel').forEach(s => {
            if(s.value) msg += `üìç *${s.dataset.point}*: ${s.value}\n`;
        });
        window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`);
    }

    function clearAllData() { if(confirm("‡∑É‡∑ë‡∂∏ ‡∂Ø‡∑ô‡∂∫‡∂ö‡∑ä‡∂∏ ‡∂∏‡∂ö‡∑è ‡∂Ø‡∑ê‡∂∏‡∑ì‡∂∏‡∂ß ‡∂Ö‡∑Ä‡∑Å‡∑ä‚Äç‡∂∫‡∂Ø?")) { localStorage.clear(); location.reload(); }}

    renderAttendance();
</script>
</body>
</html>

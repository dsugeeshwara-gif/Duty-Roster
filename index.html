<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Duty Point Setup v11.0</title>
    <style>
        :root { --primary: #2563eb; --success: #10b981; --dark: #1e293b; --bg: #f1f5f9; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); margin: 0; padding: 10px; }
        .container { max-width: 800px; margin: auto; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        
        /* Navigation */
        .step-info { background: #dbeafe; padding: 10px; border-radius: 8px; text-align: center; margin-bottom: 20px; font-weight: bold; color: var(--primary); }
        .nav-controls { display: flex; justify-content: space-between; align-items: center; margin-top: 25px; border-top: 2px solid #eee; padding-top: 20px; }
        
        /* Point Header */
        .point-display { background: var(--dark); color: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; text-align: center; }
        .point-display h2 { margin: 0; font-size: 24px; letter-spacing: 1px; }

        /* Staff Grid */
        .search-box { width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px; margin-bottom: 15px; box-sizing: border-box; }
        .staff-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 10px; max-height: 400px; overflow-y: auto; padding: 10px; border: 1px solid #eee; border-radius: 8px; }
        
        .sw-container { display: flex; align-items: center; justify-content: space-between; padding: 10px; background: #fff; border: 1px solid #e2e8f0; border-radius: 8px; cursor: pointer; }
        .sw-container.active { background: #dcfce7; border-color: var(--success); }
        .sw-label { font-size: 13px; font-weight: bold; }
        .sw-box { width: 34px; height: 18px; background: #cbd5e1; border-radius: 20px; position: relative; }
        .sw-box::after { content: ''; width: 14px; height: 14px; background: white; border-radius: 50%; position: absolute; top: 2px; left: 2px; transition: 0.3s; }
        .active .sw-box { background: var(--success); }
        .active .sw-box::after { left: 18px; }

        .btn { padding: 12px 25px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .btn-next { background: var(--primary); color: white; }
        .btn-prev { background: #64748b; color: white; }
        .btn-save { background: var(--success); color: white; }
    </style>
</head>
<body>

<div class="container" id="main-container">
    <div class="step-info" id="stepIndicator">Point 1 of 42</div>

    <div class="point-display">
        <small>දැනට සකසන ස්ථානය (Current Point)</small>
        <h2 id="currentPointName">Guard Room</h2>
    </div>

    <input type="text" class="search-box" id="staffSearch" placeholder="සේවකයෙකු සොයන්න (Search name...)" oninput="renderStaff()">

    <div class="staff-list" id="staffList">
        </div>

    <div class="nav-controls">
        <button class="btn btn-prev" id="prevBtn" onclick="changePoint(-1)">Back</button>
        <button class="btn btn-next" id="nextBtn" onclick="changePoint(1)">Next Point</button>
    </div>
    
    <button class="btn btn-save" style="width:100%; margin-top:10px;" onclick="goToRoster()">රාජකාරි වගුව බලන්න (View Roster)</button>
</div>

<script>
    const points = ["Guard Room - Post 01", "Guard Room - Post 02", "M/E Entry - 01", "M/E Entry - 02", "Time Office", "B/C/P - Post 01", "B/C/P - Post 02", "Glass Door", "Lobby - Post 01", "Lobby - Post 02", "C/P/R", "Doctors' Lift", "Pharmacy - Main", "Pharmacy - OPD", "Pharmacy - Helper", "CCTV New - 01", "CCTV New - 02", "C/P/03", "C/P/04", "Commercial Hostel", "Rounds - 01", "Rounds - 02", "Kitchen Stores", "Kitchen", "Main Gate", "2nd Basement", "SICU", "MICU", "CCTV Old - 01", "CCTV Old - 02", "Lift Lobby - 3rd Floor", "Lift Lobby - 4th Floor", "Lift Lobby - 5th Floor", "Lift Lobby - 6th Floor", "Fort City", "Lady Hostel - New", "Hostal - Old", "Hostal - New", "Layanal Area", "Bambalapitiya Area", "Dilan Area", "Receiving"];

    const staffNames = ["OIC අසංක", "OIC කුමාර", "OIC සුරංජිත්", "OIC සමරනායක", "OIC දයාරත්න", "OIC සුරේෂ්", "OIC මෙන්ඩිස්", "OIC විජිතලාල්", "OIC රංගන", "SSO තාරක", "SSO ජයලත්", "SSO විරේශ්", "SSO රවී", "SSO අජිත්", "SSO මනූෂ", "SSO රත්නදාස", "LOIC රීටා", "LOIC මල්කාන්ති", "JSO ප්‍රසන්න", "JSO ප්‍රදීප්", "JSO චන්දන", "JSO විජේරත්න", "JSO රාජ්", "JSO දිනේෂ්", "JSO රවිඳු", "JSO ලොකුබංඩා", "JSO සුනිල්", "JSO සම්පත්", "LSO සීලවතී", "LSO නාලනී", "LSO විමලසූරිය", "LSO නන්දනී", "LSO නන්දලතා", "LSO ඩිලානි", "LSO ශ්‍රියාලතා", "LSO ශාන්ති", "LSO නුගවෙල", "LSO චම්පිකා", "LSO පෙරේරා"];

    let pointStaffMap = JSON.parse(localStorage.getItem('pointStaffMap_v11')) || {};
    let currentPointIdx = 0;

    function renderStaff() {
        const list = document.getElementById('staffList');
        const searchTerm = document.getElementById('staffSearch').value.toLowerCase();
        const currentPoint = points[currentPointIdx];
        
        list.innerHTML = "";
        staffNames.forEach(name => {
            if (name.toLowerCase().includes(searchTerm)) {
                const isActive = (pointStaffMap[currentPoint] || []).includes(name);
                list.innerHTML += `
                    <div class="sw-container ${isActive ? 'active' : ''}" onclick="toggleStaff('${name}')">
                        <span class="sw-label">${name}</span>
                        <div class="sw-box"></div>
                    </div>`;
            }
        });
        
        document.getElementById('currentPointName').innerText = currentPoint;
        document.getElementById('stepIndicator').innerText = `Point ${currentPointIdx + 1} of ${points.length}`;
        document.getElementById('prevBtn').disabled = currentPointIdx === 0;
        document.getElementById('nextBtn').innerText = currentPointIdx === points.length - 1 ? "Finish" : "Next Point";
    }

    function toggleStaff(name) {
        const point = points[currentPointIdx];
        if (!pointStaffMap[point]) pointStaffMap[point] = [];
        
        if (pointStaffMap[point].includes(name)) {
            pointStaffMap[point] = pointStaffMap[point].filter(n => n !== name);
        } else {
            pointStaffMap[point].push(name);
        }
        
        localStorage.setItem('pointStaffMap_v11', JSON.stringify(pointStaffMap));
        renderStaff();
    }

    function changePoint(step) {
        currentPointIdx += step;
        if (currentPointIdx < 0) currentPointIdx = 0;
        if (currentPointIdx >= points.length) {
            alert("සියලුම පොයින්ට්ස් සැකසීම අවසන්!");
            currentPointIdx = points.length - 1;
        }
        document.getElementById('staffSearch').value = ""; // Clear search
        renderStaff();
    }

    function goToRoster() {
        alert("රොස්ටර් එක බැලීමට සූදානම්. (මෙහිදී ඔබ On කළ සේවකයින් පමණක් අදාළ පොයින්ට් එකට පෙන්වනු ඇත)");
        // මෙතැනින් Roster Page එකට Link කළ හැක
    }

    renderStaff();
</script>
</body>
</html>

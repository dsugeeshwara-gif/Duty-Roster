<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IronShield Defender Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --primary: #1a237e; --secondary: #d32f2f; --bg: #f4f7f6; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding-bottom: 80px; }
        .header { background: var(--primary); color: white; padding: 20px; text-align: center; position: sticky; top: 0; z-index: 100; }
        
        .screen { display: none; padding: 15px; animation: fadeIn 0.3s; }
        .active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Welcome Screen */
        .shift-box { display: flex; gap: 10px; margin-bottom: 20px; }
        .shift-btn { flex: 1; padding: 20px; border: 2px solid var(--primary); border-radius: 10px; text-align: center; cursor: pointer; font-weight: bold; }
        .shift-btn.active-shift { background: var(--primary); color: white; }

        /* Search Bar */
        .search-container { position: sticky; top: 75px; background: var(--bg); padding: 10px 0; z-index: 90; }
        .search-bar { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #ccc; box-sizing: border-box; }

        /* List Items */
        .card { background: white; padding: 12px; border-radius: 8px; margin-bottom: 10px; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .switch { position: relative; display: inline-block; width: 50px; height: 24px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 24px; }
        input:checked + .slider { background-color: #2e7d32; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 4px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider:before { transform: translateX(26px); }

        /* Footer */
        .footer-nav { position: fixed; bottom: 0; width: 100%; background: white; padding: 15px; border-top: 1px solid #ddd; display: flex; gap: 10px; box-sizing: border-box; }
        .btn { flex: 1; padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .btn-next { background: var(--primary); color: white; }
        .btn-add { background: #607d8b; color: white; }

        .duty-point { background: white; padding: 15px; border-radius: 8px; margin-bottom: 10px; border-left: 5px solid var(--secondary); cursor: pointer; }
        .assigned-tag { float: right; color: #2e7d32; font-weight: bold; }
    </style>
</head>
<body>

<div class="header">
    <div id="app-title">IRONSHIELD DEFENDER PRO</div>
</div>

<div id="attendance-screen" class="screen active">
    <div class="shift-box">
        <div class="shift-btn active-shift" onclick="setShift('‡∂Ø‡∑í‡∑Ä‡∑è ‡∂∏‡∑î‡∂ª‡∂∫', this)">‡∂Ø‡∑í‡∑Ä‡∑è ‡∂∏‡∑î‡∂ª‡∂∫</div>
        <div class="shift-btn" onclick="setShift('‡∂ª‡∑è‡∂≠‡∑ä‚Äç‡∂ª‡∑ì ‡∂∏‡∑î‡∂ª‡∂∫', this)">‡∂ª‡∑è‡∂≠‡∑ä‚Äç‡∂ª‡∑ì ‡∂∏‡∑î‡∂ª‡∂∫</div>
    </div>

    <div class="search-container">
        <input type="text" class="search-bar" id="staffSearch" placeholder="‡∂Ö‡∂Ç‡∂ö‡∂∫ ‡∑Ñ‡∑ù ‡∂±‡∂∏ ‡∑É‡∑ú‡∂∫‡∂±‡∑ä‡∂±..." onkeyup="filterStaff()">
    </div>

    <div id="staff-list-container">
        </div>

    <div class="footer-nav">
        <button class="btn btn-add" onclick="addNewStaff()"><i class="fas fa-plus"></i> ‡∂Ö‡∂Ω‡∑î‡∂≠‡∑ä ‡∂±‡∑í‡∂Ω‡∂∞‡∑è‡∂ª‡∑í‡∂∫‡∑ô‡∂ö‡∑ä</button>
        <button class="btn btn-next" onclick="showDutyScreen()">‡∂∏‡∑ì‡∑Ö‡∂ü‡∂ß <i class="fas fa-arrow-right"></i></button>
    </div>
</div>

<div id="duty-screen" class="screen">
    <h3>‡∑É‡∑ä‡∂Æ‡∑è‡∂±‡∂∫ ‡∂≠‡∑ù‡∂ª‡∑è ‡∂±‡∑í‡∂Ω‡∂∞‡∑è‡∂ª‡∑í‡∂∫‡∑ô‡∂ö‡∑î ‡∂¥‡∂≠‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±</h3>
    <div id="duty-points-container">
        </div>
    <div class="footer-nav">
        <button class="btn btn-add" onclick="backToAttendance()"><i class="fas fa-arrow-left"></i> ‡∂Ü‡∂¥‡∑É‡∑î</button>
        <button class="btn btn-next" style="background: #2e7d32;" onclick="generateReport()">WhatsApp ‡∂∫‡∑Ä‡∂±‡∑ä‡∂±</button>
    </div>
</div>

<div id="officerModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:200; overflow-y:auto; padding:20px; box-sizing:border-box;">
    <h3 style="color:white;">‡∂±‡∑í‡∂Ω‡∂∞‡∑è‡∂ª‡∑í‡∂∫‡∑ô‡∂ö‡∑î ‡∂≠‡∑ù‡∂ª‡∂±‡∑ä‡∂±</h3>
    <div id="available-officers-list"></div>
    <button class="btn btn-add" style="width:100%; margin-top:20px;" onclick="closeModal()">‡∂Ö‡∑Ä‡∂Ω‡∂Ç‡∂ú‡∑î ‡∂ö‡∂ª‡∂±‡∑ä‡∂±</button>
</div>

<script>
    let currentShift = "‡∂Ø‡∑í‡∑Ä‡∑è ‡∂∏‡∑î‡∂ª‡∂∫";
    let staff = [
        { id: "001", rank: "OIC", name: "Asanka", present: true },
        { id: "002", rank: "SSO", name: "Tharaka", present: true },
        { id: "003", rank: "JSO", name: "Prasanna", present: true },
        { id: "004", rank: "LSO", name: "Nandani", present: true }
    ];
    let points = ["Guard Room (Post 01)", "Main Entry", "Time Office", "CCTV Room", "Hostel Area"];
    let assignments = {};
    let activePoint = null;

    function setShift(shift, el) {
        currentShift = shift;
        document.querySelectorAll('.shift-btn').forEach(btn => btn.classList.remove('active-shift'));
        el.classList.add('active-shift');
    }

    function renderStaff() {
        const container = document.getElementById('staff-list-container');
        container.innerHTML = staff.map((s, index) => `
            <div class="card" data-name="${s.rank} ${s.name} ${s.id}">
                <div><strong>${s.id}</strong> - ${s.rank} ${s.name}</div>
                <label class="switch">
                    <input type="checkbox" ${s.present ? 'checked' : ''} onchange="toggleAttendance(${index})">
                    <span class="slider"></span>
                </label>
            </div>
        `).join('');
    }

    function toggleAttendance(index) {
        staff[index].present = !staff[index].present;
    }

    function filterStaff() {
        let val = document.getElementById('staffSearch').value.toLowerCase();
        document.querySelectorAll('#staff-list-container .card').forEach(card => {
            card.style.display = card.dataset.name.toLowerCase().includes(val) ? 'flex' : 'none';
        });
    }

    function showDutyScreen() {
        document.getElementById('attendance-screen').classList.remove('active');
        document.getElementById('duty-screen').classList.add('active');
        renderDutyPoints();
    }

    function backToAttendance() {
        document.getElementById('duty-screen').classList.remove('active');
        document.getElementById('attendance-screen').classList.add('active');
    }

    function renderDutyPoints() {
        const container = document.getElementById('duty-points-container');
        container.innerHTML = points.map(p => `
            <div class="duty-point" onclick="openOfficerSelection('${p}')">
                <i class="fas fa-map-marker-alt"></i> ${p}
                <span class="assigned-tag" id="tag-${p}">${assignments[p] || '‡∂¥‡∂≠‡∑ä ‡∂ö‡∂ª ‡∂±‡∑ê‡∂≠'}</span>
            </div>
        `).join('');
    }

    function openOfficerSelection(point) {
        activePoint = point;
        const modal = document.getElementById('officerModal');
        const list = document.getElementById('available-officers-list');
        modal.style.display = 'block';

        const presentStaff = staff.filter(s => s.present);
        list.innerHTML = presentStaff.map(s => `
            <div class="card" onclick="assignOfficer('${s.rank} ${s.name}')">
                ${s.rank} ${s.name} (${s.id})
            </div>
        `).join('');
    }

    function assignOfficer(name) {
        assignments[activePoint] = name;
        closeModal();
        renderDutyPoints();
    }

    function closeModal() {
        document.getElementById('officerModal').style.display = 'none';
    }

    function generateReport() {
        let msg = `*üõ°Ô∏è IRONSHIELD ROSTER - ${currentShift}*\n\n`;
        points.forEach(p => {
            msg += `üìç *${p}:* ${assignments[p] || '---'}\n`;
        });
        window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`, '_blank');
    }

    function addNewStaff() {
        let name = prompt("‡∂±‡∑í‡∂Ω‡∂∞‡∑è‡∂ª‡∑í‡∂∫‡∑è‡∂ú‡∑ö ‡∂±‡∂∏ ‡∂á‡∂≠‡∑î‡∑Ö‡∂≠‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±:");
        if(name) {
            staff.push({ id: "NEW", rank: "S/G", name: name, present: true });
            renderStaff();
        }
    }

    renderStaff();
</script>
</body>
</html>

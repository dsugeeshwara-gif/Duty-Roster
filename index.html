<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Duty Point Setup v10.0</title>
    <style>
        :root { --primary: #2563eb; --success: #10b981; --dark: #1e293b; --bg: #f1f5f9; }
        body { font-family: 'Inter', system-ui, -apple-system, sans-serif; background: var(--bg); margin: 0; padding: 10px; }
        .container { max-width: 1100px; margin: auto; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; background: #e2e8f0; padding: 5px; border-radius: 10px; }
        .tab { flex: 1; text-align: center; padding: 12px; cursor: pointer; border-radius: 8px; font-weight: bold; transition: 0.3s; }
        .tab.active { background: var(--primary); color: white; }
        .hidden { display: none; }

        /* Point Section Styles */
        .point-block { border: 1px solid #cbd5e1; border-radius: 12px; margin-bottom: 25px; overflow: hidden; }
        .point-title { background: var(--dark); color: white; padding: 12px 20px; font-size: 18px; font-weight: bold; display: flex; justify-content: space-between; }
        
        .staff-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px; padding: 15px; background: #fff; }
        
        /* Switch Style */
        .sw-container { display: flex; align-items: center; justify-content: space-between; padding: 8px 12px; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; cursor: pointer; transition: 0.2s; }
        .sw-container:hover { background: #eff6ff; }
        .sw-container.active { background: #dcfce7; border-color: var(--success); }
        
        .sw-label { font-size: 14px; font-weight: 500; }
        .sw-box { width: 40px; height: 20px; background: #cbd5e1; border-radius: 20px; position: relative; transition: 0.3s; }
        .sw-box::after { content: ''; width: 16px; height: 16px; background: white; border-radius: 50%; position: absolute; top: 2px; left: 2px; transition: 0.3s; }
        .active .sw-box { background: var(--success); }
        .active .sw-box::after { left: 22px; }

        .sticky-header { position: sticky; top: 0; background: white; padding: 10px 0; z-index: 100; border-bottom: 2px solid #eee; margin-bottom: 20px; }
        .action-btn { background: var(--primary); color: white; border: none; padding: 15px 30px; border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 16px; }
    </style>
</head>
<body>

<div class="container">
    <div class="sticky-header">
        <div class="tabs">
            <div class="tab active" onclick="showTab('setup-tab')">පොයින්ට් එකට සේවකයින් සැකසීම</div>
            <div class="tab" onclick="showTab('roster-tab')">රාජකාරි බෙදාහැරීම</div>
        </div>
        <div id="setup-info" style="font-size: 13px; color: #666; padding: 0 10px;">
            සෑම පොයින්ට් එකක් යටතේම එම ස්ථානයට සුදුසු සේවකයින්ගේ ස්වීචය On කරන්න.
        </div>
    </div>

    <div id="setup-tab">
        <div id="pointContainer"></div>
    </div>

    <div id="roster-tab" class="hidden">
        <h2 style="text-align:center;">අවසන් රාජකාරි වගුව</h2>
        <table id="rosterTable" style="width:100%; border-collapse: collapse;">
            <thead>
                <tr style="background:var(--dark); color:white;">
                    <th style="padding:15px; text-align:left;">ස්ථානය (Duty Point)</th>
                    <th style="padding:15px; text-align:left;">සුදුසු නිලධාරියා තෝරන්න</th>
                </tr>
            </thead>
            <tbody id="rosterBody"></tbody>
        </table>
    </div>
</div>

<script>
    const points = ["Guard Room", "Pharmacy", "Lobby", "CCTV", "Doctors' Lift", "Rounds", "Time Office", "Main Gate"];
    
    const staffNames = [
        "OIC අසංක", "OIC කුමාර", "OIC සුරංජිත්", "OIC සමරනායක", "OIC දයාරත්න", "OIC සුරේෂ්", "OIC මෙන්ඩිස්", "OIC විජිතලාල්", "OIC රංගන",
        "SSO තාරක", "SSO ජයලත්", "SSO විරේශ්", "SSO රවී", "SSO අජිත්", "SSO මනූෂ", "SSO රත්නදාස",
        "LOIC රීටා", "LOIC මල්කාන්ති",
        "JSO ප්‍රසන්න", "JSO ප්‍රදීප්", "JSO චන්දන", "JSO විජේරත්න", "JSO රාජ්", "JSO දිනේෂ්", "JSO රවිඳු", "JSO ලොකුබංඩා", "JSO සුනිල්", "JSO සම්පත්",
        "LSO සීලවතී", "LSO නාලනී", "LSO විමලසූරිය", "LSO නන්දනී", "LSO නන්දලතා", "LSO ඩිලානි", "LSO ශ්‍රියාලතා", "LSO ශාන්ති", "LSO නුගවෙල", "LSO චම්පිකා", "LSO පෙරේරා"
    ];

    // Data Structure: { "Guard Room": ["OIC අසංක", "OIC කුමාර"], "Pharmacy": ["LSO සීලවතී"] }
    let pointStaffMap = JSON.parse(localStorage.getItem('pointStaffMap_v10')) || {};

    function showTab(tabId) {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.getElementById('setup-tab').classList.add('hidden');
        document.getElementById('roster-tab').classList.add('hidden');
        document.getElementById(tabId).classList.remove('hidden');
        event.currentTarget.classList.add('active');
        if(tabId === 'roster-tab') renderRoster();
    }

    function renderSetup() {
        const container = document.getElementById('pointContainer');
        container.innerHTML = "";

        points.forEach(p => {
            let staffHTML = staffNames.map(name => {
                const isActive = (pointStaffMap[p] || []).includes(name);
                return `
                    <div class="sw-container ${isActive ? 'active' : ''}" onclick="toggleMapping('${p}', '${name}')">
                        <span class="sw-label">${name}</span>
                        <div class="sw-box"></div>
                    </div>
                `;
            }).join('');

            container.innerHTML += `
                <div class="point-block">
                    <div class="point-title">
                        <span>${p}</span>
                        <small style="font-size:12px; font-weight:normal;">සුදුසු සේවකයින් තෝරන්න</small>
                    </div>
                    <div class="staff-grid">${staffHTML}</div>
                </div>
            `;
        });
    }

    function toggleMapping(point, name) {
        if (!pointStaffMap[point]) pointStaffMap[point] = [];
        
        if (pointStaffMap[point].includes(name)) {
            pointStaffMap[point] = pointStaffMap[point].filter(n => n !== name);
        } else {
            pointStaffMap[point].push(name);
        }
        
        localStorage.setItem('pointStaffMap_v10', JSON.stringify(pointStaffMap));
        renderSetup();
    }

    function renderRoster() {
        const body = document.getElementById('rosterBody');
        body.innerHTML = "";

        points.forEach(p => {
            const allowedStaff = pointStaffMap[p] || [];
            let options = allowedStaff.map(s => `<option value="${s}">${s}</option>`).join('');
            
            body.innerHTML += `
                <tr style="border-bottom:1px solid #eee;">
                    <td style="padding:15px;"><b>${p}</b></td>
                    <td style="padding:15px;">
                        <select style="width:100%; padding:10px; border-radius:5px; border:1px solid #ccc;">
                            <option value="">-- සුදුසු නිලධාරීන් ${allowedStaff.length} ක් ඇත --</option>
                            ${options}
                        </select>
                    </td>
                </tr>
            `;
        });
    }

    renderSetup();
</script>
</body>
</html>
